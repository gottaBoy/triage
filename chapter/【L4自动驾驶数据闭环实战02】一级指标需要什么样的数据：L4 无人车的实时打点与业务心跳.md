在第一篇里，我把整个自动驾驶组织类比成一个强化学习（RL）系统，重点讲了两件事：

我们把每万公里“蠢表现”的次数，叫做 MPS（Miles per Stupid）；
把每万公里真正危险 / 事故的次数，叫做 MPD（Miles per Dangerous）。
从组织视角看，MPS / MPD 就是整个系统的“目标函数”：
你希望 MPD 越低越好，在安全约束下 MPS 越低越好，同时还要兼顾效率、覆盖率等约束。

如果套一点 RL 的话：

MPS / MPD 更像是长期回报 J(π)：
而我们设计的各种 trigger + 事件统计，
本质是在构建“奖励函数基底”——把连续的驾驶时间序列离散成一串有语义的惩罚 token；
真正意义上的“loss”，是用这些 MPS / MPD 指标再去构造出来的训练 / 评估目标。
先有 MPS / MPD 这个“想要什么样的世界”，
然后我们才去设计 trigger、打点体系，把这个目标函数拆解成可以度量、可以优化的具体数据。

这一篇就专门回答一个问题：

要想把 MPS / MPD 真的量出来、实时看得见，
L4 无人车上到底需要什么样的数据？这些数据又是如何打点和上传的？
顺便把 MPD 说清楚：D 到底是什么“Dangerous”
前面一直在说 MPS / MPD，有必要把 MPD 里的这个 D 到底怎么定义 讲清楚一下，不然很容易变成“拍脑袋感觉危险”的那种玄学指标。

在我们的体系里，MPD（Miles per Dangerous）统计的不是任何小 bug，而是「在现实世界里已经构成了事故或公众普遍认同的危险事件」，主要包括几类：

实际事故 / 碰撞事件
车辆与行人、非机动车、社会车辆、固定设施发生了接触或明显的挤压；
造成了实际的财产损失（有资损），比如车损、路产损失等；
不管最后责任怎么判，只要物理世界里真的撞上了，就算一次 Dangerous。
2. 交警出警 / 有正式记录的安全事件

需要交警出警、现场处置、或者形成了正式警情 / 事故认定文书的事件；
包括一些没有大额资损、但已经引发了社会关注或投诉的安全事件；
简单说：已经从“车队内部问题”升级成“公共安全事件” 的，都会计入 MPD。
3. 内部定义的「重大近失误」

这类属于 Near-Miss，但已经严重到需要按事故级别处理，比如：
车虽然最终没撞上，但刹停距离非常短、TTC 极低，周围行人/车明显受惊、急避让；
被内部安全委员会认定为“如条件稍有不同就会变成事故”的事件；
这类我们也会归入 Dangerous，只是可以在内部再细分一个「Near-Miss Dangerous」子类。
很多人会担心：这听上去有点主观，会不会吵不完？

实践下来，其实没那么玄学——因为我们是刻意用「贴近公众直觉」的标准来定义 MPD 的：

只要是 一般路人 / 客户 / 交警看到都会觉得“这是危险 / 出事了” 的情况，都应该计入 D；
至于事故责任在谁、保险怎么赔，那是另外一套体系；
MPD 只关心“物理世界中发生了什么”，而不是“责任算在谁头上”。
如果有必要，内部甚至可以维护两套口径：

一个是 MPD_all：只要发生危险事件就计入，不看责任归属；
一个是 MPD_resp：只统计责任主要在我们侧的事件。
但无论内部怎么拆，对外沟通和对组织对齐方向的时候，最重要的是：

MPD 代表的是「这车在真实世界里会不会伤到人、撞到东西、造成社会层面的麻烦」，
它是一个尽量贴近公众直觉、争议空间尽量小的安全底线指标。
有了这样的定义，MPS / MPD 就有了分工：

MPD：用来约束安全底线——「不能出事」；
MPS：用来约束体验上限——「别老干蠢事」。
后面的所有 Trigger 设计、数据打点、闭环机制，都是围绕着这两个“目标函数”展开的。

一个我们内部争论很久的真实例子
光讲原则有时候是空的，这里举一个我们团队真实遇到、内部争论了很久的例子。

有一次我们的车在一个路口，由于感知误检了前方障碍物，车辆触发了一次明显的急刹车。
紧跟在我们车后面的是一个外卖小哥，当时距离不算特别远，他在发现我们急刹时已经来不及完全刹停，只能本能地向左猛打方向避让。

结果是：

我们的车和外卖车之间没有发生任何物理碰撞；
外卖小哥在急打方向和制动的过程中摔倒了，人和车都有一定程度的受伤 / 受损；
他很快自己爬起来，扶起电动车继续送餐，没有报警，也没有交警出警、没有形成正式记录。
这起事故在内部其实争论了很久：

有人认为：“毕竟没追尾到我们车，也没出警，只能算一个体验问题 / 小事故。”
也有人认为：“从物理结果看，人已经摔倒了，这在公众直觉里就是一次危险事件。”
最后我们拍板的结论是：

这起事件在我们的口径里，依然要算一次 Dangerous，计入 MPD。
原因有两个：

MPD 看的是物理世界里有没有真实的安全后果
人已经因为我们的急刹而摔倒，这本身就是实打实的安全事件；
至于有没有走报警、定责、理赔流程，是另外一套体系，不影响它在 MPD 里的归类。
MPD 的定义要尽量贴近公众的一般感知
对外卖小哥、对路人来说，他不会在意你感知里是不是“误检了一个假障碍物”；
他只会记得「前车突然一下急刹，我为了躲它摔了」，
这在任何一个普通人的语境里，都会被描述成一次危险场景。
所以在我们的系统里：

即便车辆本身没有发生直接碰撞；
即便没有交警出警、没有正式事故单；
只要因我们的行为在物理世界里已经发生了明显的摔倒 / 受伤 / 资损风险，
我们都会把它视作一次 Dangerous 事件，纳入 MPD。
也正是这些案例，让我们在设计 MPD 的时候更加坚定了一个原则：

MPD 的边界，要尽量按照“公众直觉”和“客观结果”来划，
而不是用各种流程和责任细节，把真正应该被当成危险的问题洗干净。
一、从 RL 视角看：
MPS / MPD 是 J，Trigger 是 R 的“基底和特征工程”

先把类比讲清楚一点。

在强化学习里，一般是这样：

每个时间步，环境给一个即时奖励 r_t = R(s_t, a_t)；
我们优化的目标，是长期回报：
J(π) = E_π[∑ γ^t r_t]
类比到数据闭环 + 指标体系里：

组织层面的目标（J）
把 MPD 降到足够低；
把 MPS（急刹、画龙、停车不走等体感差事件）压到合理水位；
同时保证基本效率、覆盖率不崩。
这些 MPS / MPD 及其加权组合，就是整个业务的 J(π)。
Trigger & 事件统计 = 奖励函数 R(s,a) 的“基底 + 特征工程”
每一次急刹 / 画龙 / 停车不走 / 危险近失误 / 接管 / error code……
在时间轴上都可以看成一次 r_t < 0 的惩罚事件；
我们用 Trigger 把连续的原始时序（Pose、控制量、传感器结果）
离散成一串有语义的事件 token，再给每一类 token 分配权重；
按万公里统计这些事件次数，就得到 MPS / MPD 这类高层指标。
训练意义上的 loss
后续如果拿这些指标 + 事件去约束仿真集、真实集上的评估，
或者把它们当成模型训练的目标，那训练时的 loss，
就是用这些 MPS / MPD 构造出来的函数。
所以顺序应该是：

先定清楚：组织的长期目标 J 是什么（MPS / MPD 体系）；
再设计：哪些事件 token（Trigger）代表着惩罚 / 奖励的基底；
然后才是：如何打点、如何上传、如何实时统计这些事件。
这一篇开始就从第 2 步和第 3 步切进去：
触发这些事件的，是怎样的一套数据打点体系？

二、一级指标要的“事实”：车在现实世界里“怎么动 + 在干什么”
对 MPS / MPD 来说，最重要的事实其实很朴素，就两类：

1. 车体姿态（Pose） + 底盘状态

在哪儿（经纬度 / 场地坐标）；
什么速度、什么纵向 / 横向加速度；
航向角、航向角速度；
方向盘转了多大角度，油门 / 刹车下了多大力。
2. 任务属性 / 场景信息

当前是在执行什么任务（从 A 到 B 的配送任务？回场？调度？）；
跑在什么类型的道路上（干线 / 场内 / 隧道 / 高架 / 非机非 / 封闭园区）；
当前任务状态（发车 / 行驶中 / 等待 / 完成）。
所以，从“数据产品”的角度看，我们先干了一件事：

在车上专门拉一条 “Pose + 任务属性专线”，
它不关心算法内部细节，只负责把“车是怎么动的、在干什么任务”这件事说清楚。
后面所有“急刹 / 画龙 / 停车不走”的事件，都是在云端从这条专线上“读”出来的。

三、车端的 Pose 专线：
为 MPS / MPD 准备的“指标事实层”

这条专线可以理解为：

一个只关心“车体姿态 + 底盘状态 + 任务属性”的小数据流，
专门服务于：急刹、画龙、停车不走等 行为事件 的判定。
典型字段长这样（示意）：

Pose 相关：
时间戳
经纬度 / 场地坐标
车速
纵向 / 横向加速度
航向角 / 航向角速度
底盘 / 控制状态：
驾驶模式（自动 / 远程 / 遥控 / 故障）
方向盘转角
算法下发的油门开度 / 刹车力度
当前是否处于制动 / 驻车 / 紧急制动状态
任务属性：
当前任务 ID
起点 / 终点（或者线路 ID）
场景类型（干线 / 场内 / 隧道 / 高架 / 非机非 / 封闭园区…）
当前任务状态（发车 / 行驶中 / 等待中 / 收车）
这条线有三个特点：

逻辑刻意保持“笨”
它不判断“是不是急刹”、“是不是停车不走”；
只按固定频率（比如 100ms / 200ms 一条）往外吐这些标量数据。
2. 体量轻、长期可存

和视频 / 点云比完全不是一个量级；
可以长时间保存，用来做历史回刷和趋势分析。
3. 和算法实现高度解耦

算法内部怎么重构，与这条线关系很小；
对数据 / QA 团队来说，这是一条稳定的“生命体征”数据流。
这就是我们给 MPS / MPD 准备的 “指标事实层”。

后面的 Trigger，其实就是把这条事实层“切块 + 打标签”的过程。

四、业务侧的“1Hz 心跳”：
自动驾驶率、里程、速度都靠它

体感类 MPS / MPD 是给算法 / 质量团队用的。
但从业务侧看，一个 L4 无人车运营团队每天会问的问题很不一样：

某个城市 / 园区 / 线路的 自动驾驶率 多少？
每天的 运营里程 和 平均速度 怎么变化？
里程结构是怎样的（多少公里在干线、多少在园区、多少在隧道 / 高架）？
这些指标，我们不是靠离线拼 log 来算，而是设计了一条：

每秒一条的“行驶心跳”，全部写进阿里云 SLS（日志服务）。
一条 1Hz 心跳大致包含（示意）：

时间戳、车辆 ID
当前驾驶模式（Auto / Remote / Manul）
当前速度
当前所在道路类型（干线 / 场内 / 隧道 / 高架 / 充电区 / 库区……）
当前任务 ID、任务状态（执行中 / 等待 / 完成）
城市、园区、线路等业务维度
用这一条“心跳流”，我们可以：

统计 自动驾驶率：Auto 时长 / 总运营时长；
统计各城市 / 园区 / 线路的 行驶里程；
做 平均速度 分析（按道路类型、按时间、按车型）；
做 里程结构 和各类业务报表。
有一个很“反直觉”的设计点：

这条 1Hz 心跳，本身是不追求“每一米绝对准确”的。
原因很现实：

真要做到“每一米都精确统计”，
你需要复杂的轨迹重建、对齐底盘计费模块……成本非常高；
但对于业务决策来说：
自动驾驶率大致是 20% 还是 80%，
平均速度大致是 20km/h 还是 35km/h，
1Hz 的心跳就已经足够稳定了。
在大数据场景里，我们更关注的是：

样本足够多 + 统计方式稳定 + 趋势可信，
而不是每一个点的绝对精度。
五、实时数据链路：
同一套打点，既做报表，也做“车队心电图”

同一条 SLS 心跳 + 实时打点流，我们接上 Flink 这样的流式处理引擎之后，它立刻有了第二重身份：

不仅是“报表数据源”，也是车队的“实时心电图”。
几个典型的实时监控场景：

5.1 车辆离线告警
通过 Flink 监控每辆车最后一次心跳时间；
某辆车超过 N 秒没有心跳，则判为“疑似离线”；
触发告警：
主动唤起远程安全员查看；
推送给线下运维同学去现场检查。
对 L4 无人车来说，这种“车自己不吭声”的问题非常典型，
它的发现路径天然就不是“接管次数”，而是这种实时状态流。

5.2 “停车不走”的实时发现
心跳里有速度、位置、任务状态；
Flink 做一个简单规则：
任务状态 = 执行中；
速度长期接近 0；
位置几乎不变，持续超过阈值（比如 5 分钟 / 10 分钟）；
触发“停车不走告警”。
这和我们在指标体系里说的“停 1 分钟看趋势，停 3 分钟看具体问题”其实是同一套逻辑，
只是这里是 实时视角 + 告警动作。

5.3 园区级异常
如果同一个园区，在某个时间窗口内大量车辆出现“执行中 + 低速 / 停滞”；
或某类 error code 短时间内高频出现；
Flink 可以识别为“园区级异常”：
可能是施工、封路、临时交通管制；
也可能是策略调整 / 地图变更带来的问题。
这些能力，本质都来自一件事：

你让所有实时状态都被标准化成打点，
流进 SLS，再用 Flink 做几秒级的聚合和检测。
同一套打点体系，同时支撑：

离线 / 近实时的业务报表；
秒级的实时监控 / 告警；
后面要讲的“天然 Trigger 驱动按需补采”。
六、离线数仓：
MaxCompute 上的 ODS / DWD / DWS / ADS，是无人车业务的大脑

实时流解决的是“几秒内发生了什么”，
但一个 L4 无人车业务真正要跑起来，离不开更宏观的问题：

哪个城市、哪个园区的业务发展得健康？
自动驾驶率在不同业务线、不同客户上的趋势如何？
哪些路线该扩充车队，哪些路线在长期亏损？
不同算法版本上线前后，对安全指标和业务指标分别有什么影响？
这些问题不看“秒级曲线”，看的是 周 / 月 / 季度维度的大盘和趋势。
这就是离线数仓要承担的角色。

我们在这块用的是 阿里云的 ODPS（MaxCompute），
在上面搭了一整套比较传统、但在无人车业务里非常好用的数仓分层：

ODS（Operational Data Store）层：
存放的是从各个源系统“原汁原味”同步过来的明细数据；
包括：SLS 的心跳日志、Pose 专线、业务订单系统数据、运维系统数据、成本数据等等。
DWD（Data Warehouse Detail）明细层：
在 ODS 的基础上做清洗、过滤、统一编码，形成“干净的明细宽表”；
比如：
每一条“行驶心跳”加上标准化的城市/园区/线路维度；
接管事件、error code 事件和车辆基本信息打通；
自动驾驶任务与订单、商家、场地属性打通。
DWS（Data Warehouse Summary）汇总层：
在明细层基础上做各类中间聚合指标；
比如：
按天 / 周 / 月的自动驾驶率；
按线路 / 场地的行驶里程和平均速度；
按业务线的 MPS / MPD 分布；
按客户的履约准时率、服务等级达成率等。
ADS（Application Data Service）应用层：
面向具体看板、报表和分析应用做的“窄表输出”；
例如：
CEO 看的一页纸自动驾驶业务总览；
运营负责人看的一套“线路 / 场地健康度”看板；
算法团队看的一套版本对比报表（新旧版本在 MPS / MPD + 业务指标上的变化）。
用更直白的话说：

SLS + Flink 和各种实时监控，保障的是“这几秒 / 这几分钟内车队没出事”；
MaxCompute 上的 ODS / DWD / DWS / ADS，保障的是“这几个月 / 这一年里，这门生意是不是在朝正确的方向跑”。
在无人车业务里，这一层非常关键，因为：

安全指标（MPS / MPD）和业务指标是要合在一起看的：
不能为了把 MPS 降到趋近于 0，就永远龟速行驶；
也不能只看履约和效率，把安全当成“另一套报表系统”。
长期的业务决策都建立在这一层上：
哪种场景值得大规模铺车？
哪种路线适合 L4 无人车，哪种路线更适合有人车或混合编队？
哪些客户 / 城市跑出来的 MPS / MPD / 利润率好，应该加大投入？
哪些策略（比如 FSD 与远程驾驶的比例、车队排班方式）是正确的？
从系统视角看，实时层 + 离线数仓层 的关系可以简单概括为：

实时层：盯着“现在”，负责守住底线，防止出大事；
数仓层：盯着“长期”，负责看清趋势，决定这门生意怎么扩、往哪走。
MPS / MPD 作为“目标函数”，在这两层里都有影子：
实时层看的是“短期波动和突发异常”，数仓层看的是“长期趋势和策略效果”。

七、“天然 Trigger”：
远程驾驶 & 错误码就是最佳监督信号

说完“指标事实”和“业务心跳 + 数仓”，再讲一个对闭环非常关键的部分：

很多最有价值的 Trigger，根本不在算法内部，而在业务行为里。
典型的几种：

远程驾驶 / 远程座舱数据
谁在什么时间接管了哪辆车；
接管的方式（手柄 / 桌面 / 移动端）；
接管前后车的状态和场景。
车辆算法的“呼叫”行为
呼叫代驾：算法认为场景太复杂，需要人来决策；
呼叫守护：算法觉得前方风险高，希望有人盯一下；
内部 error code：比如“激光定位失败”、“语义地图异常”等。
接管过程中的语音说明（ASR 成文本）
远程安全员一边接管一边吐槽：
“差点闯红灯”；
“这红绿灯不对”；
“前面明明没东西也急刹”；
云端用 ASR 把这些语音转成文本，
再甩给规则引擎 / LLM 做进一步理解。
这些都是非常宝贵的监督信号，因为：

它们自带语义
error code 本身就说明“哪一类模块感觉不舒服”；
远程接管说明“车觉得自己搞不定 / 人觉得不放心”；
语音文本里经常出现“红绿灯 / 逆行 / 非法停车”等关键字。
它们天然就是“奖励函数的基底”
某类 error code 可以拆成单独的“惩罚维度”；
某类接管 + 某类语音可以触发专项问题分析；
某些行为可以被赋予更大的权重，直接影响 MPS / MPD 的设计。
在我们的体系里，这些“业务 Trigger”会被统一收进 SLS，
再通过 Flink + 规则引擎转成一个个 “待分析事件（case stub）”，
然后驱动后续的 micro/mini log 上传和重数据补采——这部分会放到下一篇详细展开。

八、小结：业务视角下的“目标函数”和数据地基
站在业务的视角回头看这一篇，其实是在讲一件事：

如果把 MPS / MPD 看成整个无人车组织的“目标函数 / KPI”，
那么，要想在大屏和报表里看到可信的数字，就必须先把“数据地基”打扎实。
这一篇我们做了三层铺垫：

把 MPS / MPD 放进一个可解释的框架里
把每万公里“蠢表现”（MPS）和“危险事件”（MPD）当成长期回报 J，
不只是安全指标，更是整个业务想长期收敛到的“目标状态”；
各种 Trigger 和事件统计，则是在干一件很“工程”的事：
把连续的车辆行为时间序列拆成一串有语义的惩罚 / 奖励 token，
让这套目标函数可以被真正度量和优化。
2. 从运营视角，回答“这些指标要喂什么样的数据”

车端的 Pose + 任务属性专线，提供“车怎么动、在干什么任务”的底层事实；
SLS 里 1Hz 的业务心跳，撑起自动驾驶率、里程、速度、场景分布等运营大盘；
Flink 在这条流上做实时处理，让这套打点既能出报表，也能当“车队心电图”。
3. 用 MaxCompute 数仓，把“此刻发生了什么”和“长期跑得好不好”连起来

ODS / DWD / DWS / ADS 这一套分层，让实时打点沉淀成月度、季度维度的业务视图；
安全指标（MPS / MPD）和业务指标（履约、效率、成本）在这里汇合，
真正决定这门 L4 无人车生意要不要扩、往哪扩、怎么扩。
从业务的角度，你可以把这一篇理解成：

在讨论“如何闭环”之前，先把“我们到底在看什么数、这些数从哪儿来”这件事讲清楚。
没有这一层，所谓“数据驱动”“数据闭环”，最终都会沦为 PPT 上的口号。
但是，到这里我们其实只回答了前半个问题：

我们定义了什么样的一级指标（MPS / MPD）；
我们知道为了这些指标，需要哪些实时打点和哪些数仓视角；
还没回答的，是一个更“物理”的问题：

在“一分钟大约4GB数据”的世界里，
这些数据在真实的带宽 / 存储 / 算力约束下，
到底应该怎么上传，才能既不烧穿预算，又不牺牲闭环能力？
这就是第三篇要展开的主题：

为什么原始数据不可能“全量上传”；
我们是怎么设计 分层数据上传机制：
实时流、事件流、原始重数据各自扮演什么角色；
指标为什么必须在云端算，而不是车端算死；
车端如何像“聪明行车记录仪”一样，只锁住最有价值的片段。
如果说这一篇更多是在业务驾驶舱里看仪表盘，
那下一篇，就是把机盖真正打开，去看这套仪表盘背后，数据是怎么被分层搬上云的